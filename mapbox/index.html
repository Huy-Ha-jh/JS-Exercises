<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mapbox Autocomplete and Map Example</title>
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.css" rel="stylesheet" />
  <style>
    body, html { margin: 0; padding: 0; height: 100%; }
    #map { width: 100%; height: 80vh; }
    #autocomplete-container {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    input {
      padding: 10px;
      font-size: 16px;
      width: 300px;
    }
    ul {
      list-style-type: none;
      padding: 0;
      margin-top: 10px;
      width: 300px;
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #ddd;
      border-radius: 5px;
      background-color: white;
    }
    li {
      padding: 10px;
      cursor: pointer;
      background-color: white;
    }
    li:hover {
      background-color: #f0f0f0;
    }

    .info-card { 
      background-color: #ffffff; 

      padding: 15px 20px; 
 
      font-family: 'Arial', sans-serif; 

   
      transition: transform 0.3s ease;
    }

    .info-card h3 {
      font-size: 18px;
      margin: 0 0 10px;
      color: #333;
    }

    .info-card p {
      font-size: 14px;
      margin: 5px 0 0;
      color: #555;
    }

    .info-card:hover {
      transform: scale(1.05); /* Slight zoom on hover */
    }
  </style>
</head>
<body>

<div id="map"></div>

<div id="autocomplete-container">
  <input type="text" id="location-input" placeholder="Search for a place...">
  <ul id="suggestions"></ul>
</div>

<script>
  mapboxgl.accessToken = 'pk.eyJ1IjoiaHV5aGExNzA1IiwiYSI6ImNtMHdsbnF6NzAyemgybHExeG1hc3Z3djkifQ.HZG1Idf72pop2QSHkf7vug'; 
  
  const hoChiMinhCity = [106.6602, 10.762622]; 

 
  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v11',
    center: hoChiMinhCity, 
    zoom: 12 
  });


  let marker = new mapboxgl.Marker()
    .setLngLat(hoChiMinhCity)
    .addTo(map);

  let popup = new mapboxgl.Popup()
    .setHTML('<div class="info-card"><h3>Ho Chi Minh City</h3><p>Coordinates: [106.6602, 10.762622]</p></div>')
    .setLngLat(hoChiMinhCity)
    .addTo(map);

  marker.setPopup(popup); 


  function updateMarker(lngLat, placeName) {
    const infoCard = document.createElement('div');
    infoCard.className = 'info-card';
    infoCard.innerHTML = `<h3>${placeName}</h3><p>Coordinates: ${lngLat}</p>`;
    
    popup.setDOMContent(infoCard); 
    popup.setLngLat(lngLat); 

    marker.setLngLat(lngLat)
      .setPopup(popup) 
      .addTo(map); 
    
    map.flyTo({ center: lngLat, zoom: 12 }); 
  }


  function fetchSuggestions(query) {
    const accessToken = mapboxgl.accessToken;
    if (query.length < 3) {
      document.getElementById('suggestions').innerHTML = '';
      return;
    }

    const url = `https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(query)}.json?access_token=${accessToken}&autocomplete=true&limit=5`;

    fetch(url)
      .then(response => response.json())
      .then(data => {
        const suggestions = data.features.map(feature => {
          return `<li data-coordinates="${feature.geometry.coordinates}" data-name="${feature.place_name}">${feature.place_name}</li>`;
        }).join('');

        document.getElementById('suggestions').innerHTML = suggestions;

       
        document.querySelectorAll('#suggestions li').forEach(li => {
          li.addEventListener('click', function () {
            const coords = this.getAttribute('data-coordinates').split(',').map(Number);
            const placeName = this.getAttribute('data-name');
            updateMarker(coords, placeName); 
            document.getElementById('suggestions').innerHTML = ''; 
            document.getElementById('location-input').value = this.textContent; 
          });
        });
      });
  }

  
  document.getElementById('location-input').addEventListener('input', function () {
    fetchSuggestions(this.value);
  });

</script>

</body>
</html>
